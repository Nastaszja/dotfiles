export ZSH=$HOME/.oh-my-zsh

#ZSH_THEME="nyquase"

plugins=(
  git
  wd
)

source $ZSH/oh-my-zsh.sh
source ~/.zplug/init.zsh

POWERLEVEL9K_MODE='awesome-fontconfig'
zplug "nyquase/powerlevel9k", use:powerlevel9k.zsh-theme
zplug "nyquase/vi-mode"
zplug "zsh-users/zsh-autosuggestions"
zplug "zsh-users/zsh-completions"
zplug "lukechilds/zsh-better-npm-completion", defer:2
zplug "zdharma/fast-syntax-highlighting", defer:2
zplug "b4b4r07/zsh-vimode-visual", defer:3
zplug 'zplug/zplug', hook-build:'zplug --self-manage'

# Install plugins if there are plugins that have not been installed
if ! zplug check --verbose; then
    printf "Install? [y/N]: "
    if read -q; then
        echo; zplug install
    fi
fi
# Then, source plugins and add commands to $PATH
zplug load

# Much export such wow
export LC_CTYPE=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export PATH="$PATH:$HOME/.cargo/bin"
export PATH="$PATH:$HOME/.local/bin"

if command -v nvim > /dev/null 2>&1; then
    export EDITOR='nvim'
else
    export EDITOR='vim'
fi

export EXA_COLORS="di=1;34"

export MANPAGER='less -s -M +Gg'


# fg when pressing Ctrl+Z
function fancy-ctrl-z () {
  if [[ $#BUFFER -eq 0 ]]; then
    if [[ $(jobs | wc -l) -gt 0 ]]; then
      BUFFER='fg'
      zle accept-line
    fi
  else
    zle push-input
    zle clear-screen
  fi
}
zle -N fancy-ctrl-z
bindkey '^Z' fancy-ctrl-z

# Keyboard layout to azerty
# Caps lock = Escape
# Faster cursor
setxkbmap fr
setxkbmap -option caps:escape
xset r rate 200 30

#Android studio
export PATH=$PATH:$HOME/Android/Sdk/emulator
export PATH=$PATH:$HOME/Android/Sdk/platform-tools
export PATH=$PATH:$HOME/Android/Sdk/tools/bin

if [ -s "$HOME/.nvm/nvm.sh" ] && [ ! "$(type -f __init_nvm)" = function ]; then
  export NVM_DIR="$HOME/.nvm"
  declare -a __node_commands=(nvm `find -L $NVM_DIR/versions/*/*/bin -type f -exec basename {} \;`)
  function __init_nvm() {
    for i in "${__node_commands[@]}"; do unalias $i; done
    source "$NVM_DIR/nvm.sh"
    unset __node_commands
    unset -f __init_nvm
  }
  for i in "${__node_commands[@]}"; do alias $i='__init_nvm && '$i; done
fi

# FZF
export FZF_DEFAULT_COMMAND='fd --type f --hidden --follow --exclude .git'

_fzf_compgen_path() {
  fd --type d --hidden --follow --exclude ".git" . "$1"
}

_fzf_compgen_dir() {
  fd --type d --hidden --follow --exclude ".git" . "$1"
}

fzf-history-widget-accept() {
  fzf-history-widget
  zle accept-line
}
zle -N fzf-history-widget-accept
bindkey '^X^R' fzf-history-widget-accept

export FZF_CTRL_T_COMMAND="$FZF_DEFAULT_COMMAND"
export FZF_DEFAULT_OPTS='--height 95%'
export FZF_CTRL_T_OPTS="--preview 'bat --style=numbers --color=always {} 2> /dev/null' || cat {}"
bindkey '^F' fzf-file-widget

export FZF_ALT_C_COMMAND='fd --type d --hidden --follow --exclude .git'
export FZF_ALT_C_OPTS="--preview 'exa --tree {} | head -200'"

fzf-edit-file() {
  fzf-file-widget
  if [[ "$BUFFER" != "" ]]; then
    BUFFER="$EDITOR $BUFFER"
    zle accept-line
  fi
}
zle -N fzf-edit-file
bindkey '^E' fzf-edit-file

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

source ~/.aliases.zsh
